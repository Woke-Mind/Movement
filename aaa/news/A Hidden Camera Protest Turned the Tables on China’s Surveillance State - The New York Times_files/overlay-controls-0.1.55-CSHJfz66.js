import{c as z,u as G,A as c,d as w,y as H,q as Q,_ as l,e as o,k as X}from"./betamax-shared-DH_j5-1B.js";import{s as Y,S as Z}from"./scrubber-CS-8uvQT.js";import{S as p}from"./event-types-ylPu1rr5.js";import{u as x}from"./keyboard-controls-Rf6m82qR.js";import{a as ee,d as te}from"./reduced-motion-rPScagHf.js";const ae="_container_cvlbt_9",ne="_controls_cvlbt_22",le="_vertical-video-controls_cvlbt_33",se="_play-button-container_cvlbt_38",re="_paused_cvlbt_70",ue="_active_cvlbt_91",oe="_play-button-inner_cvlbt_122",ie="_play-button_cvlbt_38",ce="_duration_cvlbt_146",pe="_icon_cvlbt_155",de="_muted_cvlbt_162",ve="_unmuted_cvlbt_166",fe="_fullscreen_cvlbt_170",be="_fullscreen-exit_cvlbt_174",me="_transcript_cvlbt_178",_e="_captions_cvlbt_182",ye="_captions-filled_cvlbt_186",ge="_link_cvlbt_190",Se="_play_cvlbt_38",Ce="_pause_cvlbt_70",he="_invisibleFade_cvlbt_211",n={container:ae,controls:ne,verticalVideoControls:le,playButtonContainer:se,paused:re,active:ue,playButtonInner:oe,playButton:ie,duration:ce,icon:pe,muted:de,unmuted:ve,fullscreen:fe,fullscreenExit:be,transcript:me,captions:_e,captionsFilled:ye,link:ge,play:Se,pause:Ce,invisibleFade:he};function B(e){if(!e)return"";let n="";const l=new URL(e.url),a=new URLSearchParams(l.search);return a.set("smid","url-share"),n=`${l.origin}${l.pathname}?${a.toString()}`,n}var Ee=(e=>(e.FirstUnmuteThenPause="first-unmute-then-pause",e.MuteUnmute="mute-unmute",e.PlayPause="play-pause",e))(Ee||{});function ke(e){return"not-supported"===e?"Fullscreen video is not supported":!1===e?"Make video fullscreen":"Exit fullscreen"}function Pe({overlayClickBehavior:e,controls:a,share:t,showDuration:u,onTranscriptClick:r}){var s;const i=null==(s=G("nyt-betamax"))?void 0:s.player;if(!i)throw new Error("Could not get player context. Is this rendering inside a betamax component?");const v=null!==ee().value,d=c(null),m=c(null),_=c(null),b=c(null),f=c(null),[y,h]=w(!1),[g,k]=w(!1),C=!a||a.includes("scrubber"),S=te(),E=!v&&("mute-unmute"!==e||!0===S.value);H((()=>{const e=i.fullscreen.subscribe((e=>{var n,l;!0===e&&!1===f.current?null==(n=i.tracking)||n.send(p.EnterFullscreen):!1===e&&!0===f.current&&(null==(l=i.tracking)||l.send(p.ExitFullscreen)),"not-supported"!==e&&(f.current=e)}));return()=>{e()}}),[i.fullscreen]);const P=Q((e=>{k(e)}),[]);function N(){const e=Object.values(I);for(const n of e)if(n){const e=n.ref;if(null!=e&&e.current)return e.current}return null}function F(e){var n;null==e||e.stopPropagation(),!g&&("paused"===(null==i?void 0:i.playState.value)?(null==i||i.play(),null==(n=N())||n.focus({preventScroll:!0})):!0!==(null==i?void 0:i.muted.value)||e instanceof PointerEvent&&0===e.detail?null==i||i.pause():null==i||i.setMuted(!1))}x({containerRef:d,playState:i.playState,setUserDrivenPlaystate:n=>{var l;"mute-unmute"!==e&&("play"===n?(i.play(),null==(l=N())||l.focus({preventScroll:!0})):i.pause())}});const T=l("div",{className:o(n.playButtonContainer,{[n.paused]:"paused"===i.playState.value})},l("button",{"aria-label":"paused"===i.playState.value?"Play":"Pause",onClick:e=>F(e),className:n.playButton,"aria-pressed":"playing"===i.playState.value},l("div",{className:o(n.playButtonInner,{[n.paused]:"paused"===i.playState.value})},l("span",{className:o(n.icon,"paused"===i.playState.value?n.play:n.pause)}))),u&&!i.hasEverPlayed.value&&i.duration.value&&l("div",{className:n.duration,"data-testid":"betamax-overlay-controls-duration"},Y(i.duration.value)));function j(e){null==i||i.setMuted(!(null!=i&&i.muted.value)),null==e||e.stopPropagation()}function M(e){var n;null==(n=null==i?void 0:i.tracking)||n.sendCustomEvent({event:p.ModuleInteraction,eventData:{trigger:"module",type:"click"},module:{region:"mid-video",name:"share-tools",element:{name:"share-url",label:"permalink",url:e.url}}})}function D(e=!0){t?(navigator.clipboard.writeText(B(t)),M(t),e&&(h(!0),setTimeout((()=>{h(!1)}),2e3))):console.warn("No share data provided")}const U=!0===i.muted.value?"Unmute":"Mute",I={fullscreen:l("button",{onClick:function(e){"not-supported"!==(null==i?void 0:i.fullscreen.value)&&(null==i||i.setFullscreen(!(null!=i&&i.fullscreen.value)),e.stopPropagation())},"aria-label":ke(i.fullscreen.value),disabled:"not-supported"===i.fullscreen.value,ref:_},l("span",{className:o(n.icon,!0===i.fullscreen.value?n.fullscreenExit:n.fullscreen)})),mute:l("button",{onClick:j,"aria-label":U,ref:m},l("span",{className:o(n.icon,!0===i.muted.value?n.muted:n.unmuted)})),share:t?l("button",{onClick:function(e){if(e.stopPropagation(),!window.isSecureContext)return void console.error("Not a secure context, and cannot share.");if(!t)return void console.log("No share data provided");if(!navigator.share||!navigator.canShare(t)||!(()=>{const e="ontouchstart"in window||navigator.maxTouchPoints>0,n=window.innerWidth<=768;return e&&n})())return void D();const n=B(t);!async function(){try{await navigator.share({title:document.title,text:n,url:n}),M(t)}catch(e){console.error(`Error sharing: ${e}. Falling back to clipboard`),D(!1)}}()},"aria-label":"Share this video",className:y?n.active:"",ref:b},l("span",{className:o(n.icon,n.link)})):null,transcript:r?l("button",{onClick:function(e){e.stopPropagation(),r&&(!0===(null==i?void 0:i.fullscreen.value)?null==i||i.setFullscreen(!1).then(r):r())},"aria-label":"Show transcript"},l("span",{className:o(n.icon,n.transcript)})):null,captions:l("button",{disabled:!i.captionsAvailable.value,onClick:function(e){var n;null==e||e.stopPropagation(),null==i||i.setCaptions(!(null!=i&&i.captions.value)),null==(n=null==i?void 0:i.tracking)||n.send(null!=i&&i.captions.value?p.EnterCaptions:p.ExitCaptions)},"aria-label":"Toggle closed captions"},l("span",{className:o(n.icon,!0===i.captions.value?n.captionsFilled:n.captions)}))};return l("div",{className:n.container,onClick:function(n){if(!g&&!v)if(!0!==S.value||"paused"!==(null==i?void 0:i.playState.value))switch(e){case"mute-unmute":j(n);break;case"play-pause":l();break;default:F(n)}else l();function l(){"paused"===(null==i?void 0:i.playState.value)?null==i||i.play():null==i||i.pause()}},ref:d,"data-testid":"betamax-overlay-controls"},E&&T,i.hasEverPlayed.value&&l(X,null,l("div",{className:o(n.controls,{[n.verticalVideoControls]:i.aspectRatio.value<=1,[n.invisibleFade]:g})},a?a.map((e=>I[e])):Object.values(I)),C?l(Z,{disableScrubbing:v,scrubCallback:P}):null))}const Me=z("nyt-betamax-overlay-controls",{"css":["https://static01.nyt.com/video-static/betamax/overlay-controls-0.1.55-lkHp5kvN.css","https://static01.nyt.com/video-static/betamax/scrubber-0.1.55-C7UsZDAv.css"],"js":[{"src":"https://static01.nyt.com/video-static/betamax/overlay-controls-0.1.55-CSHJfz66.js","entry":true},{"src":"https://static01.nyt.com/video-static/betamax/betamax-shared-DH_j5-1B.js","entry":false},{"src":"https://static01.nyt.com/video-static/betamax/scrubber-CS-8uvQT.js","entry":false},{"src":"https://static01.nyt.com/video-static/betamax/event-types-ylPu1rr5.js","entry":false},{"src":"https://static01.nyt.com/video-static/betamax/keyboard-controls-Rf6m82qR.js","entry":false},{"src":"https://static01.nyt.com/video-static/betamax/reduced-motion-rPScagHf.js","entry":false}]},Pe);export{Ee as OverlayClickBehavior,Me as OverlayControls};
//# sourceMappingURL=overlay-controls-0.1.55-CSHJfz66.js.map